"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const n=require("electron"),l=require("inversify");let s=null;function p(){return s||(s=new l.Container({defaultScope:"Singleton",autoBindInjectable:!1})),s}async function u(r){for(const e of r)e.start&&(console.log(`[electron-core] Starting module ${e.constructor.name}`),await e.start())}async function d(r){for(const e of r.slice().reverse())e.stop&&(console.log(`[electron-core] Stopping module ${e.constructor.name}`),await e.stop())}function g(r){n.app.on("before-quit",async e=>{console.log("[electron-core] App before quit"),e.preventDefault();try{await d(r)}catch(o){console.error(`[electron-core] Error during shutdown' ${o}`)}finally{console.log("[electron-core] App quitting"),n.app.exit(0)}})}async function f(r){const{appId:e,modules:o=[]}=r;if(!e)throw new Error("[electron-core] appId is required");console.log(`[electron-core] Starting app ${e}`);const i=p();for(const t of o)try{console.log(`[electron-core] Registering module: ${t.constructor.name}`),t.register(i)}catch(c){throw console.error(`[electron-core] Failed to register module: ${t.constructor.name}`,c),c}g(o),await n.app.whenReady(),console.log("[electron-core] App ready");try{await u(o)}catch(t){console.error("[electron-core] Failed to start modules",t),n.app.exit(1)}}class y{constructor(){this.registered=new Set}register(e,o){if(this.registered.has(e))throw new Error(`[ipc] Channel already registered: ${e}`);this.registered.add(e),n.ipcMain.handle(e,async(i,...t)=>{try{return await o(...t)}catch(c){throw console.error(`[ipc] Handler error: ${e}`,c),new Error("IPC_OPERATION_FAILED")}})}clear(){for(const e of this.registered)n.ipcMain.removeHandler(e);this.registered.clear()}}const a={APP_GET_VERSION:"app:getVersion"};class h{constructor(){this.registry=new y}register(e){this.registry.register(a.APP_GET_VERSION,async()=>n.app.getVersion())}async stop(){this.registry.clear()}}exports.IPC_CHANNELS=a;exports.IpcModule=h;exports.createElectronApp=f;
