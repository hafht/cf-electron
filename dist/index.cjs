"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const n=require("electron"),i=require("inversify");let c=null;function s(){return c||(c=new i.Container({defaultScope:"Singleton",autoBindInjectable:!1})),c}async function u(o){for(const e of o)e.start&&(console.log(`[ElectronCore] Starting module ${e.constructor.name}`),await e.start())}async function p(o){for(const e of o.slice().reverse())e.stop&&(console.log(`[ElectronCore] Stopping module ${e.constructor.name}`),await e.stop())}function d(o){n.app.on("before-quit",async e=>{console.log("[ElectronCore] App before quit"),e.preventDefault();try{await p(o)}catch(r){console.error(`[ElectronCore] Error during shutdown' ${r}`)}finally{console.log("[ElectronCore] App quitting"),n.app.exit(0)}})}async function f(o){const{appId:e,modules:r=[]}=o;if(!e)throw new Error("[ElectronCore] appId is required");console.log(`[ElectronCore] Starting app ${e}}`);const a=s();for(const t of r)try{console.log(`[ElectronCore] Registering module: ${t.constructor.name}`),t.register(a)}catch(l){throw console.error(`[ElectronCore] Failed to register module: ${t.constructor.name}`,l),l}d(r),await n.app.whenReady(),console.log("[ElectronCore] App ready");try{await u(r)}catch(t){console.error("[ElectronCore] Failed to start modules",t),n.app.exit(1)}}exports.createElectronApp=f;
